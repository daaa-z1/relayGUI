<!DOCTYPE html>
<html>
  <head>
    <title>GPIO Control</title>
    <!-- Latest compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    />
    <style>
      .btn-space {
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="text-center">GPIO Control</h1>
      <div class="row">
        {% for pin in pins %}
        <div class="col-md-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title text-center">{{ pin[2] }}</h3>
            </div>
            <div class="panel-body" id="panel-body-{{ pin[0] }}">
              <p>
                Status: {% if pin[3] == 1 %}Door is Closed{% else %}Door is
                Open{% endif %}
              </p>
            </div>
            <div class="panel-footer">
              {% if pin[0] % 2 == 1 %}
              <!-- Control odd pin -->
              <form
                action="/toggle_pin/{{ pin[0] }}"
                method="POST"
                data-message="Opening {{ pin[2] }}"
                onsubmit="updatePanelBody(event)"
                class="btn-space"
              >
                <input type="hidden" name="state" value="1" />
                <button type="submit" class="btn btn-primary">Open</button>
              </form>
              <form
                action="/toggle_pin/{{ pin[0] }}"
                method="POST"
                data-message="Stopping Opening {{ pin[2] }}"
                onsubmit="updatePanelBody(event)"
                class="btn-space"
              >
                <input type="hidden" name="state" value="0" />
                <button type="submit" class="btn btn-danger">Stop Open</button>
              </form>
              {% else %}
              <!-- Control even pin -->
              <form
                action="/toggle_pin/{{ pin[0] }}"
                method="POST"
                data-message="Closing {{ pin[2] }}"
                onsubmit="updatePanelBody(event)"
                class="btn-space"
              >
                <input type="hidden" name="state" value="1" />
                <button type="submit" class="btn btn-primary">Close</button>
              </form>
              <form
                action="/toggle_pin/{{ pin[0] }}"
                method="POST"
                data-message="Stopping Closing {{ pin[2] }}"
                onsubmit="updatePanelBody(event)"
                class="btn-space"
              >
                <input type="hidden" name="state" value="0" />
                <button type="submit" class="btn btn-danger">Stop Close</button>
              </form>
              {% endif %}
              <form
                action="/delete_pin/{{ pin[0] }}/{{ pin[1] }}"
                method="POST"
              >
                <button
                  type="submit"
                  class="btn btn-warning btn-block"
                  onclick="return confirm('Are you sure you want to delete this pin?');"
                >
                  Delete
                </button>
              </form>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      <div class="row">
        <div class="col-md-4 col-md-offset-4">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h3 class="panel-title text-center">Add New Pin</h3>
            </div>
            <div class="panel-body">
              <form action="/add_pin" method="POST">
                <div class="form-group">
                  <label for="odd_pin">Odd Pin Number:</label>
                  <input
                    type="number"
                    class="form-control"
                    id="odd_pin"
                    name="odd_pin"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="even_pin">Even Pin Number:</label>
                  <input
                    type="number"
                    class="form-control"
                    id="even_pin"
                    name="even_pin"
                    required
                  />
                </div>
                <div class="form-group">
                  <label for="name">Name:</label>
                  <input
                    type="text"
                    class="form-control"
                    id="name"
                    name="name"
                    required
                  />
                </div>
                <button type="submit" class="btn btn-success btn-block">
                  Add Pin
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Update the panel body with a message when submitting a form
      function updatePanelBody(event) {
        event.preventDefault();
        var message = event.target.getAttribute("data-message");
        var panelBodyId = event.target.parentNode.previousElementSibling.id;
        var panelBody = document.getElementById(panelBodyId);
        panelBody.innerHTML = "<p>" + message + "</p>";
        event.target.submit();
      }
    </script>
  </body>
</html>
